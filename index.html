<!DOCTYPE html>
<html>
<head>
    <!-- DataTables dependencies -->
    <!-- Just to see how git works! -->
    <style type="text/css" title="currentStyle">
        @import "DataTables-1.9.4/media/css/jquery.dataTables.css";
    </style>
    <script type="text/javascript" charset="utf-8" src="DataTables-1.9.4/media/js/jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="DataTables-1.9.4/media/js/jquery.dataTables.js"></script>

    <script>
        
        
        $.expr[':'].textEquals = function(objNode, intStackIndex, arrProperties, arrNodeStack) {
            return $(objNode).text() == arrProperties[3];
        }
        
        
        
        
        /*
         * @author Brandon Foster
         * @version 2013.05.22
         *
         * Finds data from an XML file to create tables grouped by catalog group.
         *
         */
        $(document).ready(function() {
            $("#test:textEquals('HI THERE')").css("backgroundColor", "blue");
            
            $.ajax({
                type: "GET",
                url: "catalog.xml",
                dataType: "xml",
                success: function(xml) {
                    
                    var catalogXml = $(xml);
                    
                    /*
                    var counter = 0;
                    
                    catalogXml.find('item').each(function() {
                        counter++;
                        
                    });
                    alert(counter);
                    */
                    
                    
                    // Empty array of strings that appear in the content of catalog group elements in the XML.
                    var groupsArray = [];
                    
                    var tableIdsArray = []; // Used in function makeDataTables(groupsArrayParam, tableIdsArrayParam)
                    
                    var tableId;
                    
                    /**
                     *
                     *@param groupsArrayParam array of values from the catalogGroup tags from the xml file
                     *@param tableIdsParam array of generated id values to be used for calling the dataTable() function on appropriate tables
                     *
                     *Loop through each xml catalogGroup tag and assign variable references to the values of
                     *that tag's siblings.
                     *
                     */
                    function makeDataTables(groupsArray, tableIdsArrayParam) {
                        for (var i = 0, len = groupsArray.length; i < len; i++) {
                            /*catalogXml.find("item catalogGroup:contains(" + groupsArray[i] + ")").each(function() {*/ 
                            var groupName = groupsArray[i];
                            catalogXml.find("item catalogGroup:textEquals('" + groupName + "')").each(function() {
                                
                                var item = $(this).parent();
                                //alert(item);
                                
                                // assign variables to the values of the catalogGroup tag's siblings
                                var partNumber = item.find('partNumber').text(),
                                    manufacturer = item.find('manufacturer').text(),
                                    catalogdescription = item.find('catalogdescription').text(),
                                    catalogGroup = item.find('catalogGroup').text(),
                                    salesprice = item.find('salesprice').text(),
                                    upgradefee = item.find('upgradefee').text();
                                
                                
                                // Dollar sign formatting for number 0 zero
                                if (salesprice.length > 0) {
                                    salesprice = "$ " + salesprice;
                                }
                                if (upgradefee.length > 0) {
                                    upgradefee = "$ " + upgradefee;
                                }
                                
                                //Get the table with the id generated by the makeGroupsArray function and create a DataTable with columns for
                                // partNumber, manufacturer, catalogDescription, salesprice and upgradefee
                                $('#' + tableIdsArray[i]).dataTable().fnAddData([
                                    partNumber,
                                    manufacturer,
                                    catalogdescription,
                                    catalogGroup,
                                    salesprice,
                                    upgradefee
                                ]);
                            });
                        }
                    }
                    
                    /**
                     *Populate array groupsArray with each catalog group
                     *
                     */
                    function makeGroupsArray(xmlFile) {
                        //Populate the groupsArray
                        xmlFile.find('item catalogGroup').each(function(index, value) {
                            var group = $(value).text();
                            tableId = group.toLowerCase().split(" ").join('-');
                            //alert(tableId);
                            
                            // check if array contains the element
                            if (groupsArray.indexOf(group) == "-1") {
                                groupsArray.push(group);
                                tableIdsArray.push(tableId);
                                
                                $('#tables-wrapper').append('<table id="' + tableId + '" class="display">'
                                                            + '<thead>'
                                                            +     '<tr>'
                                                            +         '<th colspan="5">' + group + '</th>'
                                                            +     '</tr>'
                                                            +     '<tr>'
                                                            +         '<th>Part Number</th>'
                                                            +         '<th>Manufacturer</th>'
                                                            +         '<th>Catalog Description</th>'
                                                            +         '<th>Catalog Group</th>'
                                                            +         '<th>Sales Price</th>'
                                                            +         '<th>Upgrade Fee*</th>'
                                                            +     '</tr>'
                                                            + '</thead>'
                                                            + '<tbody>'
                                                            + '</tbody>'
                                                         +'</table>'
                                );
                            }
                        });
                        //makeDataTables(groupsArray, tableIdsArray);
                        //alert("size of tableIdsArray: " + tableIdsArray.length);
                        //alert("size of groupsArray: " + groupsArray.length);
                    }

                    
                    makeGroupsArray(catalogXml);
                    makeDataTables(groupsArray, tableIdsArray);
                    alert(groupsArray);
                    alert(tableIdsArray);


                    /*
                    var myString = "Ip Phones";
                    var pattern = / /;
                    var replacement = "-";
                    console.log(myString.toLowerCase().replace(pattern, replacement));
                    */
                }
            });
        });
    </script>

</head>
<body>
                
    <div id="test">HI THERE</div>

    <div id="tables-wrapper">
    </div>
</body>
</html>